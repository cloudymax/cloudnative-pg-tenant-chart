---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: {{ .Values.name }}
spec:
  instances: {{ .Values.instances}}
  {{- with .Values.backup }}
  backup:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  monitoring:
    enablePodMonitor: {{ .Values.monitoring.enablePodMonitor }}
  {{- with .Values.postgresql }}
  postgresql:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  storage:
    size: {{ .Values.storage.size }}
  {{- with .Values.bootstrap }}
  bootstrap:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  {{- if .Values.certificates.generate }}
  certificates:
    serverTLSSecret: "{{ .Values.name}}-server-cert"
    serverCASecret: "{{ .Values.name}}-server-ca"
    clientCASecret: "{{ .Values.name}}-client-ca"
    replicationTLSSecret: "{{ .Values.name }}-client-cert"
  {{ else }}
  {{- with .Values.certificates }}
  certificates:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  {{- end }}
